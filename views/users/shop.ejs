<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>teccas</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- nice select CSS -->
    <link rel="stylesheet" href="css/nice-select.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <link rel="shortcut icon" href="/images/teccas.jpg" type="image/x-icon">
    <link rel="stylesheet" href="css/price_rangs.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <h1></h1>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <h1 class="nav mt-3">Teccas</h1>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/">Home</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link " href="/shop" id="navbarDropdown_1" role="button"
                                        aria-haspopup="true" aria-expanded="false">
                                        Shop
                                    </a>

                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/profile">Profile</a>
                                </li>





                                <li class="nav-item">
                                    <div class="dropdown mt-4 ms-5">
                                        <button class="btn  dropdown-toggle" type="button" id="dropdownMenuButton1"
                                            data-bs-toggle="dropdown">
                                            Click
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                            <% if(session!=null){ %>
                                                <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                                <% }else{%>
                                                    <li><a class="dropdown-item" href="/login">Login</a></li>
                                                    <li><a class="dropdown-item" href="/signup">Signup</a></li>
                                                    <%}%>
                                        </ul>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">

                            <a href="/wishlist"><i class="ti-heart"></i></a>
                            <div class="dropdown cart">
                                <a class="dropdown-toggle" id="navbarDropdown3" role="button" data-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                                    <a href="/cart"><i class="fas fa-cart-plus"></i></a>
                                </a>


                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>

    </header>

    <!--================Home Banner Area =================-->
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>Shop Items</h2>
                            <p>Home <span>-</span> Shop Items</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    <!--================Category Product Area =================-->
    <section class="cat_product_area section_padding">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 col-6">
                    <div class="left_sidebar_area">





                        <aside class="left_widgets p_filter_widgets">
                            <div class="l_w_title">

                            </div>
                        </aside>
                        <aside class="left_widgets p_filter_widgets">

                            <input style="margin-left: 29px;" onkeyup="filtersearch()" id="search" type="text"
                                placeholder="Search Product ">


                            <div class="l_w_title">
                                <h3>Browse Categories</h3>
                            </div>
                            <div class="widgets_inner">
                                <ul class="list">
                                    <% category.forEach((element)=> { %>
                                        <li>
                                            <label for="">
                                                <%=element.name%>
                                                    <input type="checkbox" onclick="category('<%=element.name%>')"
                                                        name="<%=element.name%>" id="<%=element.name%>"
                                                        value="<%=element.name%>">

                                            </label>

                                        </li>
                                        <% }); %>
                                </ul>
                            </div>

                        </aside>

                        <aside class="left_widgets p_filter_widgets">
                            <div class="l_w_title">
                                <h3>Brand filters</h3>
                            </div>
                            <div class="widgets_inner">
                                <ul class="list">
                                    <% brand.forEach((element)=> { %>
                                        <li>
                                            <label>
                                                <%= element.brandName %>
                                                    <input type="checkbox" onclick="brand('<%= element.id %>')"
                                                        id="<%= element.id %>" value="<%= element.brandName %>">
                                            </label>
                                        </li>
                                        <% }); %>
                                </ul>
                            </div>



                        </aside>

                        <aside class="left_widgets p_filter_widgets">
                            <div class="l_w_title">
                                <h3>Price Filter</h3>
                            </div>
                            <div class="widgets_inner">
                                <ul class="list">
                                    <ul class="list">
                                        <li>
                                            <label for="">
                                                3000-above
                                                <input onclick="price(4)" type="checkbox" value="3000" id="FOUR">
                                            </label><br>
                                        </li>
                                        <li>
                                            <label for="">
                                                2000-2999
                                                <input onclick="price(3)" type="checkbox" value="2000,2999" id="THREE">
                                            </label><br>
                                        </li>
                                        <li class="active">
                                            <label for="">
                                                1000-1999
                                                <input onclick="price(2)" type="checkbox" value="1000,1999" id="TWO">
                                            </label><br>
                                        </li>
                                        <li>
                                            <label for="">
                                                0-999
                                                <input onclick="price(1)" type="checkbox" value="0,999" id="ONE">
                                            </label><br>
                                        </li>

                                    </ul>
                            </div>
                        </aside>



                    </div>
                </div>
                <div class="col-lg-9">


                    <div id="Filter" class="row align-items-center latest_product_inner">
                        <% product.forEach(function(item) { %>
                            <div class="col-lg-4 col-sm-6">
                                <div class="single_product_item">
                                    <img src="<%= item.productImages[0] %>" alt="">
                                    <div class="single_product_text">
                                        <h4>
                                            <%= item.productName %>
                                        </h4>
                                        <h3>$<%= item.price %>
                                        </h3>
                                        <a href="/productShop?id=<%= item._id %>">View Details</a>
                                        <a href="/addToCart?id=<%= item._id %>" class="add_cart">+ add to cart</a>
                                        <% if (user && user.wishlist && user.wishlist.includes(item._id)) { %>
                                            <a href="/removeFromWishlist?id=<%= item._id %>" class="already_wishlist">
                                                <i class="fa-solid fa-heart"></i>
                                            </a>
                                            <% } else if (user) { %>
                                                <a href="/addToWishlist?id=<%= item._id %>" class="like_us">
                                                    <i class="ti-heart"></i>
                                                </a>
                                                <% } %>
                                    </div>
                                </div>
                            </div>
                            <% }); %>
                    </div>







                </div>
                <div class="col-lg-7">

                </div>
                <div class=" d-flex justify-content-center align-items-center" id="pagination">
                    <div class="pagination__option">
                        <%for(let j=1;j<=totalPages;j++){%>
                            <a href="?page=<%=j%>">
                                <%=j%>
                            </a>
                            <%}%>
                                <a href=""><i class="fa fa-angle-right"></i></a>
                    </div>
                </div>

            </div>
        </div>
        </div>
    </section>


    <!--================End Category Product Area =================-->

    <!-- ::footer_part start:: -->
    <footer class="footer_part" style="background-color:#e9ecef;">
        <div class="container">
            <div class="row justify-content-around">
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Top Products</h4>
                        <ul class="list-unstyled">
                            <li><a>H&M</a></li>
                            <li><a>Jack & JONES</a></li>
                            <li><a>ADIDAS</a></li>
                            <li><a>NIKE</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Quick Links</h4>
                        <ul class="list-unstyled">
                            <li><a href="/profile">PROFILE</a></li>
                            <li><a href="/shop">SHOP</a></li>
                            <li><a href="/cart">CART</a></li>
                            <li><a href="/wishlist">WISHLIST</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Features</h4>
                        <ul class="list-unstyled">
                            <li><a>Wallet</a></li>
                            <li><a>Pagination</a></li>
                            <li><a>Return</a></li>
                            <li><a>Filter</a></li>
                        </ul>
                    </div>
                </div>


            </div>

        </div>
        <div class="d-flex justify-content-center mt-5">
            <div class="footer_icon social_icon">
                <ul class="list-unstyled">
                    <li><a class="single_social_icon" href="https://github.com/mariyambi" target="_blank"><i
                                 class="fa-brands fa-github"></i></a></li>
                    <li><a class="single_social_icon" href="https://twitter.com/mariyambi" target="_blank"><i
                                class="fab fa-twitter"></i></a></li>
                    <li><a class="single_social_icon" href="https://www.linkedin.com/in/mariyambi-701125249"
                            target="_blank"><i class="fa-brands fa-linkedin"></i></a></li>
                    <li><a class="single_social_icon" href="https://instagram.com/mariyambi?igshid=YmMyMTA2M2Y="
                            target="_blank"><i class="fa-brands fa-square-instagram"></i></a></li>
                </ul>
            </div>
        </div>
    </footer>
    <!-- ::footer_part end:: -->



    <!-- jquery plugins here-->
    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/stellar.js"></script>
    <script src="js/price_rangs.js"></script>

    <!-- custom js -->
    <%if(message){%>
        <script>
            new Swal({
                title: "Success",
                text: "<%=message%>",
                icon: "success",
                showConfirmButton: false,
                timer: 2000
            });
        </script>
        <%}%>


            <script>
                let n = 0
                let b = 0
                let categorys = []
                let brands = []
                let search
                let page;
                let prices = []
                let filterprice = []
                function category(ID) {


                    if ($(`#${ID}`).is(':checked') == true) {
                        categorys[n] = $(`#${ID}`).val()
                        n++
                        console.log(categorys);
                        console.log($(`#${ID}`).is(':checked'))
                    } else {
                        console.log($(`#${ID}`).is(':checked'))
                        console.log(categorys.indexOf(`${$(`#${ID}`).val()}`));
                        let index = categorys.indexOf(`${$(`#${ID}`).val()}`)
                        categorys.splice(index, 1)
                        n--
                        console.log(categorys);
                    }
                    submit(categorys, filterprice, search, brands, page)

                }
                function pagination(button) {
                    page = button.value;
                    console.log(page);
                    submit(categorys, brands, search, filterprice, page)
                }

                function submit(categorys, brands) {
                    hidePagination();
                    $.ajax({
                        url: '/shopFilter',
                        type: 'post',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({ categorys, brands, filterprice, search, page }),
                        success: (res) => {
                            let html = []
                            if (res.itemsToShow) {

                                $('#Filter').html('')

                                if(res.itemsToShow[0].length <= 0 ) {
                                     html+= `<div class="d-flex justify-content-center ml-4">
                                        <h4>No product found :(</h4>
                                        </div>`
                                }else {
                                    res.itemsToShow.forEach(value => {
                                    value.forEach((item, i) => {
                                        html += `<div class="col-lg-4 col-sm-6">
                            <div class="single_product_item">
                                
                                   
                                             <img src="${item.productImages[0]}" alt="">
                                    <div class="single_product_text">
                                        
                                        <h4>${item.productName}</h4>
                                        <h3>$${item.price}</h3>
                                        <a href="/productShop?id=${item._id}" >View Details</a>
                                        <a href="/addToCart?id=${item._id}" class="add_cart">+ add to cart</a>
                                        <a href="/addToWishlist?id=${item._id}" class="like_us">
                                    
                                </div>
                                </div> 
                            
                        </div> `

                                    })

                                });
                                }

                               
                                console.log(html)
                                $('#Filter').html(html)




                            }
                            if (res.totalPages) {
                                console.log(res.totalPages);
                                let html = '';
                                for (let i = 1; i <= res.totalPages; i++) {
                                    html += `<div style="display: flex;margin-left: 5px;background-color: "white"; justify-content: center; align-items: center;">   
  <button style="border-radius: 50%; width: 39px; height: 39px;" id="ashiq${i}" onclick="pagination(this)" value="${i}">${i}</button>
</div>
`;
                                }
                                $('#pagination').html(html);
                            }


                        }
                    })
                }

                function brand(id) {
                    hidePagination();
                    if ($('#' + id).is(':checked') == true) {
                        brands[b++] = $('#' + id).val();
                    } else {
                        const index = brands.indexOf($('#' + id).val());
                        brands.splice(index, 1);
                        b--;
                    }
                    console.log(brands, '=============');
                    submit(categorys, brands, search, filterprice, page);
                }

                function filtersearch() {
                    hidePagination();
                    search = $('#search').val()
                    submit(categorys, brands, search, filterprice, page)
                }


                function price(check) {
                    hidePagination();
                    filterprice = []
                    let one, two, three, fore
                    let n = 0, index
                    if ($("#ONE").is(':checked') == true) {
                        one = $("#ONE").val()
                        prices[n] = one
                        n++
                    } else if (check == 1) {
                        index = prices.indexOf($("#ONE").val())
                        prices.splice(index, 1)

                    }
                    if ($("#TWO").is(':checked') == true) {
                        two = $("#TWO").val()
                        prices[n] = two
                        n++
                    } else if (check == 2) {
                        index = prices.indexOf($("#TWO").val())
                        prices.splice(index, 1)

                    }
                    if ($("#THREE").is(':checked') == true) {
                        three = $("#THREE").val()
                        prices[n] = three
                        n++
                    } else if (check == 3) {
                        index = prices.indexOf($("#THREE").val())
                        prices.splice(index, 1)

                    }
                    if ($("#FOUR").is(':checked') == true) {
                        fore = $("#FOUR").val()
                        prices[n] = fore
                        n++
                    } else if (check == 4) {
                        index = prices.indexOf($("#FOUR").val())
                        prices.splice(index, 1)

                    }
                    let length
                    if (prices) {
                        length = prices.length
                    }


                    if (prices.length == 1 && prices[length - 1].split(',').length == 2) {
                        let first = [prices[length - 1]]
                        first = first[0].split(',')

                        filterprice[0] = first[0]
                        filterprice[1] = first[1]

                    } else if (prices.length == 1 && prices[length - 1].split(',').length == 1) {
                        console.log('50000');
                        let first = []
                        first[0] = prices[0]
                        filterprice[0] = first[0]
                        console.log(filterprice);
                    } else if (prices.length > 1 && prices[length - 1].split(',').length == 2) {
                        let first = [prices[0]]
                        let second = [prices[length - 1]]
                        first = first[0].split(',')
                        second = second[0].split(',')
                        filterprice[0] = first[0]
                        filterprice[1] = second[1]
                        console.log(filterprice);
                    } else if (prices.length > 1 && prices[length - 1].split(',').length == 1) {
                        let first = [prices[0]]
                        first = first[0].split(',')
                        filterprice[0] = first[0]
                        console.log(filterprice);
                        console.log('dhcf');
                    }
                    submit(categorys, brands, search, filterprice, page)
                }


            </script>
            <script>

                function hidePagination() {
                    var paginationElement = document.querySelector('.pagination__option');
                    if (paginationElement) {
                        paginationElement.style.display = 'none';
                    }
                }

            </script>


</body>

</html>