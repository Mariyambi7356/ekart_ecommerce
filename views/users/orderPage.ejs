<!doctype html>
<html lang="zxx">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>teccas</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- animate CSS -->
  <link rel="stylesheet" href="css/animate.css">
  <!-- owl carousel CSS -->
  <link rel="stylesheet" href="css/owl.carousel.min.css">
  <!-- nice select CSS -->
  <link rel="stylesheet" href="css/nice-select.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="css/all.css">
  <!-- flaticon CSS -->
  <link rel="stylesheet" href="css/flaticon.css">
  <link rel="stylesheet" href="css/themify-icons.css">
  <!-- font awesome CSS -->
  <link rel="stylesheet" href="css/magnific-popup.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
  <!-- swiper CSS -->
  <link rel="stylesheet" href="css/slick.css">
  <link rel="stylesheet" href="css/price_rangs.css">
  <link rel="shortcut icon" href="/images/teccas.jpg" type="image/x-icon">
  <!-- style CSS -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<body>
  <header class="main_menu home_menu">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg navbar-light">
            <h1></h1>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="menu_icon"><i class="fas fa-bars"></i></span>
            </button>

            <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <h1 class="nav mt-3">Teccas</h1>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link " href="/shop" id="navbarDropdown_1" role="button" aria-haspopup="true"
                    aria-expanded="false">
                    Shop
                  </a>

                </li>

                <li class="nav-item">
                  <a class="nav-link" href="/profile">Profile</a>
                </li>



                <li class="nav-item">
                  <div class="dropdown mt-4 ms-5">
                    <button class="btn  dropdown-toggle" type="button" id="dropdownMenuButton1"
                      data-bs-toggle="dropdown">
                      Click
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                      <% if(session!=null){ %>
                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                        <% }else{%>
                          <li><a class="dropdown-item" href="/login">Login</a></li>
                          <li><a class="dropdown-item" href="/signup">Signup</a></li>
                          <%}%>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <div class="hearer_icon d-flex">

              <a href="/wishlist"><i class="ti-heart"></i></a>
              <div class="dropdown cart">
                <a class="dropdown-toggle" id="navbarDropdown3" role="button" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false">
                  <a href="/cart"><i class="fas fa-cart-plus"></i></a>
                </a>


              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>

  </header>
  <!-- Header part end-->
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2>Order History</h2>
              <p>Order <span>-</span> History</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->


  <section class="cart_area padding_top">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <% if(orders.length>0){%>
            <%for(let i=0;i<orders.length;i++){ %>
              <table class="table mt-4">
                <thead>
                  <tr>
                    <th scope="col">Product</th>
                    <th scope="col">Name</th>
                    <th scope="col">quantity</th>
                    <th scope="col">price</th>
                    <th scope="col">Status</th>
                  </tr>
                </thead>

                <tbody>
                  <%for(let j=0;j<orders[i].item.length;j++){%>



                    <tr>
                      <td>
                        <div class="media">
                          <div class="d-flex">
                            <img style="width: 75px; height: 75px" class="rounded-circle"
                              src="<%=orders[i].item[j].product.productImages[0]%>"
                              alt="<%=orders[i].item[j].product.productName%>" />

                          </div>
                          <div class="media-body">

                          </div>
                        </div>
                      </td>
                      <td>
                        <p>
                          <%=orders[i].item[j].product.productName%>
                        </p>
                      </td>
                      <td>
                        <p>
                          <%=orders[i].item[j].quantity%>
                        </p>


                      </td>
                      <td>
                        <div class="product_count">

                          <p>
                            <%=orders[i].item[j].quantity*orders[i].item[j].product.price%>
                          </p>

                        </div>
                      </td>
                      <td>
                        <% if (orders[i].item[j].isCancel === true) { %>
                          <span class="badge bg-danger">Cancelled</span>
                        <% } else if (orders[i].is_delivered===false && orders[i].is_returned===0 &&
                          orders[i].user_cancelled==false && orders[i].admin_cancelled==false) { %>
                          <span class="badge bg-warning">pending</span>
                          <% } else if (orders[i].is_delivered===true && orders[i].is_returned===0 &&
                            orders[i].user_cancelled==false && orders[i].admin_cancelled==false) { %>
                            <span class="badge bg-success">Delivered</span>
                            <% } else if (orders[i].is_returned===1 && orders[i].user_cancelled==false &&
                              orders[i].admin_cancelled==false) { %>
                              <span class="badge bg-warning">Returned</span>
                              <% } else { %>
                                <span class="badge bg-danger">Cancelled</span>
                                <% } %>

                                 
                      </td>
                      <td>
                        <% if (orders[i].user_cancelled === false && orders[i].item[j].isCancel === false) { %>
  <a href="/cancelProduct?orderId=<%= orders[i]._id %>&productId=<%= orders[i].item[j].product._id %>" class="btn btn-danger">Cancel order</a>
<% } %>


                    </td>
                    <% }%>
                    </tr>
                 

                </tbody>
              </table>
             <% console.log(orders[i])%>
              <% if(orders[i].is_returned===0){ %>
                <% if (orders[i].is_delivered===true) { %>
                  <% const deliveryDate=new Date(orders[i].delivered_date); %>
                    <% const returnDate=new Date(deliveryDate.getTime() + (14 * 24 * 60 * 60 * 1000)); %>
                      <% const currentDate=new Date(); %>
                        <% if (currentDate <=returnDate) { %>

                          <a href="/returnOrder?orderId=<%=orders[i]._id %>" class="btn btn-danger">Return order</a>
                          <% } %>

                            <% } else { %>
                        <% if (orders[i].user_cancelled === false) { %>
                          <a href="/cancelOrder?orderId=<%=orders[i]._id%>" class="btn btn-danger">Cancel order</a>

                          <% } %>
                              
                              <% } %>
                                <%} else { %>

                                  <% } %>
                                    <a href="/orderDetails?orderId=<%=orders[i]._id%>" class="btn "
                                      style="background-color: black;color: white;">order detalils</a>

                                    <%}%>

        </div>
      </div>
      <td>
    </a>
</td>


                            <% } %>
      <div class="col-lg-12 d-flex justify-content-center">
        <div class="col-lg-5"></div>
        <div class="col-lg-7 mt-5">
          <div class="pagination__option ">
            <%for(let j=1;j<=totalPages;j++){%>
              <a href="?page=<%=j%>">
                <%=j%>
              </a>
              <%}%>
                <a href=""><i class="fa fa-angle-right"></i></a>
          </div>
        </div>
      </div>
  </section>
  <% %>
    <!--================Cart Area =================-->

    <!--================End Cart Area =================-->


    <!-- ::footer_part start:: -->
    <footer class="footer_part" style="background-color:#e9ecef;">
      <div class="container">
        <div class="row justify-content-around">
          <div class="col-sm-6 col-lg-2">
            <div class="single_footer_part">
              <h4>Top Products</h4>
              <ul class="list-unstyled">
                <li><a>H&M</a></li>
                <li><a>Jack & JONES</a></li>
                <li><a>ADIDAS</a></li>
                <li><a>NIKE</a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-6 col-lg-2">
            <div class="single_footer_part">
              <h4>Quick Links</h4>
              <ul class="list-unstyled">
                <li><a href="/profile">PROFILE</a></li>
                <li><a href="/shop">SHOP</a></li>
                <li><a href="/cart">CART</a></li>
                <li><a href="/wishlist">WISHLIST</a></li>
              </ul>
            </div>
          </div>
          <div class="col-sm-6 col-lg-2">
            <div class="single_footer_part">
              <h4>Features</h4>
              <ul class="list-unstyled">
                <li><a>Wallet</a></li>
                <li><a>Pagination</a></li>
                <li><a>Return</a></li>
                <li><a>Filter</a></li>
              </ul>
            </div>
          </div>


        </div>

      </div>
      <div class="d-flex justify-content-center mt-5">
        <div class="footer_icon social_icon">
          <ul class="list-unstyled">
            <li><a class="single_social_icon" href="https://github.com/Ashiqquee" target="_blank"><i
                  class="fa-brands fa-github"></i></a></li>
            <li><a class="single_social_icon" href="https://twitter.com/ashiqquee" target="_blank"><i
                  class="fab fa-twitter"></i></a></li>
            <li><a class="single_social_icon" href="https://www.linkedin.com/in/muhammed-ashique-701125249"
                target="_blank"><i class="fa-brands fa-linkedin"></i></a></li>
            <li><a class="single_social_icon" href="https://instagram.com/ashiqquee?igshid=YmMyMTA2M2Y="
                target="_blank"><i class="fa-brands fa-square-instagram"></i></a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- ::footer_part end:: -->

    <!-- jquery plugins here-->
    <!-- jquery -->
    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/stellar.js"></script>
    <script src="js/price_rangs.js"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>